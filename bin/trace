#!/bin/sh
set -eu
# _OPTS='-Xdebug -agentlib:jdwp=transport=dt_socket,address=127.0.0.1:1337,server=y,suspend=y'
if [ -z ${JAVA_HOME+x} ]; then
    TOOLS_JAR=$(./gradlew -q tools_jar)
else
    TOOLS_JAR=${JAVA_HOME}/lib/tools.jar
fi

if [ ! -f ${TOOLS_JAR} ]; then
    echo "Couldn't find tools.jar at '${TOOLS_JAR}'. Please specify JAVA_HOME,"
    echo "  such that '$JAVA_HOME/lib/tools.jar' exists."
    exit 1
fi

./gradlew shadow
java \
    -cp "${TOOLS_JAR}":./bp/build/libs/bp.jar \
    io.snyk.agent.bp.Trace \
    "$@"
